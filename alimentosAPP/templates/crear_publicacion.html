
<h2>Crear Publicación</h2>

<form method="post">
    {% csrf_token %}
    {{ pub_form.as_p }}

    <h3>Productos</h3>
    {{ formset.management_form }}

    <div id="formset-container">
        {% for form in formset %}
            <div class="producto-form" style="margin-bottom: 20px; border: 1px solid #ccc; padding: 10px;">
                {{ form.as_p }}
                {% if form.can_delete %}
                    {{ form.DELETE }} <label>Eliminar</label>
                {% endif %}
            </div>
        {% endfor %}
    </div>

    <button type="button" id="add-product">Agregar Producto</button>
    <button type="submit">Publicar</button>
</form>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        flatpickr("input[type='date']", {
            dateFormat: "Y-m-d",
            altInput: true,
            altFormat: "d/m/Y",
            locale: "es"
        });
    });
</script>
<!-- JS: jQuery + manejo dinámico -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const addBtn = document.getElementById('add-product');
        const container = document.getElementById('formset-container');

        // Obtén el número total de formularios
        let totalForms = document.getElementById('id_form-TOTAL_FORMS');

        addBtn.addEventListener('click', function () {
            const formCount = parseInt(totalForms.value);
            const firstForm = container.querySelector('.producto-form');
            const newForm = firstForm.cloneNode(true); // clona el primer formulario

            // Limpia los valores de los campos clonados
            newForm.querySelectorAll('input, select').forEach(function(input) {
                if (input.type !== 'hidden') {
                    input.value = '';
                }
            });

            // Reemplaza los índices de los nombres y ids
            newForm.innerHTML = newForm.innerHTML.replace(/form-(\d)+/g, `form-${formCount}`);
            container.appendChild(newForm);
            totalForms.value = formCount + 1;
        });
    });
</script>

<a href="{% url 'entidad' %}">Volver</a>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr">

